<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Introduction to ivs</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Introduction to ivs</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ivs)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(clock)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>ivs (said, “eye-vees”) is a package dedicated to working with
intervals in a generic way. It introduces a new type, the
<strong>i</strong>nterval <strong>v</strong>ector, which is generally
referred to as an <strong>iv</strong>. An iv is generally created from
two parallel vectors representing the starts and ends of the intervals,
like this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interval vector of integers</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">iv</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">11</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;integer&gt;[5]&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [1, 7)  [2, 8)  [3, 9)  [4, 10) [5, 11)</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Interval vector of dates</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>starts <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;2019-01-01&quot;</span>) <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">2</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>ends <span class="ot">&lt;-</span> starts <span class="sc">+</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">iv</span>(starts, ends)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;date&gt;[3]&gt;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [2019-01-01, 2019-01-03) [2019-01-02, 2019-01-07) [2019-01-03, 2019-01-13)</span></span></code></pre></div>
<p>The neat thing about interval vectors is that they are generic, so
you can create them from any comparable type that is supported by vctrs.
For example, the integer64 type from the bit64 package:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> bit64<span class="sc">::</span><span class="fu">as.integer64</span>(<span class="st">&quot;900000000000&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> start <span class="sc">+</span> <span class="dv">1234</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">iv</span>(start, end)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;integer64&gt;[1]&gt;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [900000000000, 900000001234)</span></span></code></pre></div>
<p>Or the year-month type from clock:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> <span class="fu">year_month_day</span>(<span class="fu">c</span>(<span class="dv">2019</span>, <span class="dv">2020</span>), <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> <span class="fu">year_month_day</span>(<span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2020</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">6</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">iv</span>(start, end)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;year_month_day&lt;month&gt;&gt;[2]&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [2019-01, 2020-02) [2020-03, 2020-06)</span></span></code></pre></div>
<p>The rest of this vignette explores some of the useful things that you
can do with ivs.</p>
</div>
<div id="structure" class="section level2">
<h2>Structure</h2>
<p>As mentioned above, ivs are created from two parallel vectors
representing the starts and ends of the intervals.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">iv</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;integer&gt;[3]&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [1, 4) [2, 5) [3, 6)</span></span></code></pre></div>
<p>You can access the starts with <code>iv_start()</code> and the ends
with <code>iv_end()</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_start</span>(x)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1 2 3</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_end</span>(x)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 4 5 6</span></span></code></pre></div>
<p>You can use an iv as a column in a data frame or tibble and it’ll
work just fine!</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x =</span> x)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 1</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           x</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;iv&lt;int&gt;&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1    [1, 4)</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2    [2, 5)</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3    [3, 6)</span></span></code></pre></div>
<div id="right-open-intervals" class="section level3">
<h3>Right-open intervals</h3>
<p>The only interval type that is supported by ivs is a
<em>right-open</em> interval, i.e. <code>[a, b)</code>. While this might
seem restrictive, it rarely ends up being a problem in practice, and
often it aligns with the easiest way to express a particular interval.
For example, consider an interval that spans the entire day of
<code>2019-01-02</code>. If you wanted to represent this interval with
second precision with a right-open interval, you’d do
<code>[2019-01-02 00:00:00, 2019-01-03 00:00:00)</code>. This nicely
captures the exclusive “end” of the interval as the start of the next
day. This also means it exactly aligns with the start of the
<em>next</em> day’s interval,
<code>[2019-01-03 00:00:00, 2019-01-04 00:00:00)</code>.</p>
<p>If you wanted to represent this with a closed interval, you might do
<code>[2019-01-02 00:00:00, 2019-01-02 23:59:59]</code>. Not only is
this a bit awkward, it can also cause issues if the precision changes!
Say you wanted to up the precision on this interval from second level
precision to millisecond precision. The right-open interval wouldn’t
have to change at all since the end of that interval is set to
<code>2019-01-03 00:00:00</code> and anything before that is fair game.
But the closed interval can’t be naively changed from
<code>2019-01-02 23:59:59</code> to
<code>2019-01-02 23:59:59.000</code>, as you’d lose the 999 milliseconds
in that last second. Extra care would have to be taken to set the
milliseconds to <code>2019-01-02 23:59:59.999</code>.</p>
<p>If you still aren’t convinced, I’d encourage you to take a look at
these resources that also advocate for right-open intervals:</p>
<ul>
<li><p><a href="https://www.cs.utexas.edu/users/EWD/transcriptions/EWD08xx/EWD831.html">Why
numbering should start at 0</a></p></li>
<li><p>These two Stack Overflow posts (<a href="https://stackoverflow.com/questions/9795391/is-there-a-standard-for-inclusive-exclusive-ends-of-time-intervals">1</a>,
<a href="https://stackoverflow.com/questions/8441749/representing-intervals-or-ranges">2</a>)
that expand on the above paper</p></li>
<li><p><a href="http://wrschneider.github.io/2014/01/07/time-intervals-and-other-ranges-should.html">Time
intervals and other ranges should be half-open</a></p></li>
</ul>
</div>
<div id="empty-intervals" class="section level3">
<h3>Empty intervals</h3>
<p>In ivs, it is required that <code>start &lt; end</code> when
generating an interval vector. This means that intervals like
<code>[5, 2)</code> are invalid, but it also means that an “empty”
interval of <code>[5, 5)</code> is also invalid. Practically, I’ve found
that attempting to allow these ends up resulting in more implementation
headaches than anything else, and they don’t end up having very many
uses.</p>
</div>
</div>
<div id="finding-overlaps" class="section level2">
<h2>Finding overlaps</h2>
<p>One of the most compelling reasons to use this package is that it
tries to make finding overlapping intervals as easy as possible.
<code>iv_locate_overlaps()</code> takes two ivs and returns a data frame
containing information about where they overlap. It works somewhat like
<code>base::match()</code> in that for each element of
<code>needles</code>, it looks for a match in <em>all</em> of
<code>haystack</code>. Unlike <code>match()</code>, it actually returns
all of the overlaps rather than just the first.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># iv_pairs() is a useful way to create small ivs from individual intervals</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>needles <span class="ot">&lt;-</span> <span class="fu">iv_pairs</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">7</span>), <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">12</span>))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>needles</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;double&gt;[3]&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [1, 5)   [3, 7)   [10, 12)</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>haystack <span class="ot">&lt;-</span> <span class="fu">iv_pairs</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>), <span class="fu">c</span>(<span class="dv">13</span>, <span class="dv">15</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">8</span>), <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>))</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>haystack</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;double&gt;[5]&gt;</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [0, 6)   [13, 15) [0, 2)   [7, 8)   [4, 5)</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>locations <span class="ot">&lt;-</span> <span class="fu">iv_locate_overlaps</span>(needles, haystack)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>locations</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   needles haystack</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1       1        1</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2       1        3</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3       1        5</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4       2        1</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5       2        5</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6       3       NA</span></span></code></pre></div>
<p>The <code>$needles</code> column of the result is an integer vector
showing where to slice <code>needles</code> to generate the intervals
that overlap the intervals in <code>haystack</code> described by the
<code>$haystack</code> column. When a needle doesn’t overlap with any
intervals in the haystack, an <code>NA</code> location is returned. An
easy way to align both <code>needles</code> and <code>haystack</code>
using this information is to pass everything to <code>iv_align()</code>,
which will automatically perform the slicing and store the results in
another data frame:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_align</span>(needles, haystack, <span class="at">locations =</span> locations)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    needles haystack</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   [1, 5)   [0, 6)</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2   [1, 5)   [0, 2)</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3   [1, 5)   [4, 5)</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4   [3, 7)   [0, 6)</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5   [3, 7)   [4, 5)</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 [10, 12) [NA, NA)</span></span></code></pre></div>
<p>If you just wanted to know if an interval in <code>needles</code>
overlapped <em>any</em> interval in <code>haystack</code>, then you can
use <code>iv_overlaps()</code>, which returns a logical vector.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_overlaps</span>(needles, haystack)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1]  TRUE  TRUE FALSE</span></span></code></pre></div>
<p>By default, <code>iv_locate_overlaps()</code> will detect if there is
any kind of overlap between the two inputs, but there are various other
<code>type</code>s of overlaps that you can detect. For example, you can
check if <code>needles</code> “contains” <code>haystack</code>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>locations <span class="ot">&lt;-</span> <span class="fu">iv_locate_overlaps</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  needles, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  haystack, </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;contains&quot;</span>, </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">no_match =</span> <span class="st">&quot;drop&quot;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_align</span>(needles, haystack, <span class="at">locations =</span> locations)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   needles haystack</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  [1, 5)   [4, 5)</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  [3, 7)   [4, 5)</span></span></code></pre></div>
<p>I’ve also used <code>no_match = &quot;drop&quot;</code> to drop all of the
<code>needles</code> that don’t have any matching overlaps.</p>
<p>You can also check for the reverse, i.e. if <code>needles</code> is
“within” the <code>haystack</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>locations <span class="ot">&lt;-</span> <span class="fu">iv_locate_overlaps</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  needles, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  haystack, </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;within&quot;</span>, </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">no_match =</span> <span class="st">&quot;drop&quot;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_align</span>(needles, haystack, <span class="at">locations =</span> locations)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   needles haystack</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  [1, 5)   [0, 6)</span></span></code></pre></div>
<div id="precedes-follows" class="section level3">
<h3>Precedes / Follows</h3>
<p>Two other functions that are related to
<code>iv_locate_overlaps()</code> are <code>iv_locate_precedes()</code>
and <code>iv_locate_follows()</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Where does `needles` precede `haystack`?</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>locations <span class="ot">&lt;-</span> <span class="fu">iv_locate_precedes</span>(needles, haystack)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>locations</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   needles haystack</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1       1        2</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2       1        4</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3       2        2</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4       2        4</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5       3        2</span></span></code></pre></div>
<p>This returns a data frame of the same structure as
<code>iv_locate_overlaps()</code>, so you can use it with
<code>iv_align()</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_align</span>(needles, haystack, <span class="at">locations =</span> locations)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    needles haystack</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   [1, 5) [13, 15)</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2   [1, 5)   [7, 8)</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3   [3, 7) [13, 15)</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4   [3, 7)   [7, 8)</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 [10, 12) [13, 15)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Where does `needles` follow `haystack`?</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>locations <span class="ot">&lt;-</span> <span class="fu">iv_locate_follows</span>(needles, haystack)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_align</span>(needles, haystack, <span class="at">locations =</span> locations)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    needles haystack</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   [1, 5) [NA, NA)</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2   [3, 7)   [0, 2)</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 [10, 12)   [0, 6)</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 [10, 12)   [0, 2)</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 [10, 12)   [7, 8)</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 [10, 12)   [4, 5)</span></span></code></pre></div>
<p>If you are only interested in the closest interval in
<code>haystack</code> that the needle precedes or follows, set
<code>closest = TRUE</code>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>locations <span class="ot">&lt;-</span> <span class="fu">iv_locate_follows</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">needles =</span> needles, </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">haystack =</span> haystack, </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">closest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">no_match =</span> <span class="st">&quot;drop&quot;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_align</span>(needles, haystack, <span class="at">locations =</span> locations)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    needles haystack</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   [3, 7)   [0, 2)</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 [10, 12)   [7, 8)</span></span></code></pre></div>
</div>
<div id="allens-interval-algebra" class="section level3">
<h3>Allen’s Interval Algebra</h3>
<p><a href="https://cse.unl.edu/~choueiry/Documents/Allen-CACM1983.pdf">Maintaining
Knowledge about Temporal Intervals</a> is a great paper by James Allen
that outlines an interval algebra that completely describes how any two
intervals are related to each other (i.e. if one interval precedes,
overlaps, or is met-by another interval). The paper describes 13
relations that make up this algebra, which are faithfully implemented in
<code>iv_locate_relates()</code> and <code>iv_relates()</code>. These
relations are extremely useful because they are <em>distinct</em>
(i.e. two intervals can only be related by exactly 1 of the 13
relations), but they are a bit too restrictive to be practically useful.
<code>iv_locate_overlaps()</code>, <code>iv_locate_precedes()</code>,
and <code>iv_locate_follows()</code> combine multiple of the individual
relations into three broad ideas that I find most useful. If you want to
learn more about this, I’d encourage you to read the help documentation
for <code>iv_locate_relates()</code>.</p>
</div>
<div id="between-ness" class="section level3">
<h3>Between-ness</h3>
<p>Often you just want to know if a vector of values falls between the
bounds of an interval. This is particularly common with dates, where you
might want to know if a sale you made corresponded to an interval range
when any commercial was being run.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>sales <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">&quot;2019-01-01&quot;</span>, <span class="st">&quot;2020-05-10&quot;</span>, <span class="st">&quot;2020-06-10&quot;</span>))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>commercial_starts <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;2019-10-12&quot;</span>, <span class="st">&quot;2020-04-01&quot;</span>, <span class="st">&quot;2020-06-01&quot;</span>, <span class="st">&quot;2021-05-10&quot;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>commercial_ends <span class="ot">&lt;-</span> commercial_starts <span class="sc">+</span> <span class="dv">90</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>commercials <span class="ot">&lt;-</span> <span class="fu">iv</span>(commercial_starts, commercial_ends)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>sales</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2019-01-01&quot; &quot;2020-05-10&quot; &quot;2020-06-10&quot;</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>commercials</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;date&gt;[4]&gt;</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [2019-10-12, 2020-01-10) [2020-04-01, 2020-06-30) [2020-06-01, 2020-08-30)</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4] [2021-05-10, 2021-08-08)</span></span></code></pre></div>
<p>You can check if a sale was made while any commercial was being run
with <code>iv_between()</code>, which works like <code>%in%</code> and
is similar to <code>iv_overlaps()</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">sales =</span> sales) <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">commercial_running =</span> <span class="fu">iv_between</span>(sales, commercials))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 2</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   sales      commercial_running</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;date&gt;     &lt;lgl&gt;             </span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 2019-01-01 FALSE             </span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 2020-05-10 TRUE              </span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 2020-06-10 TRUE</span></span></code></pre></div>
<p>You can find the commercials that were airing when the sale was made
with <code>iv_locate_between()</code> and <code>iv_align()</code>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_align</span>(sales, commercials, <span class="at">locations =</span> <span class="fu">iv_locate_between</span>(sales, commercials))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      needles                 haystack</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 2019-01-01                 [NA, NA)</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 2020-05-10 [2020-04-01, 2020-06-30)</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 2020-06-10 [2020-04-01, 2020-06-30)</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 2020-06-10 [2020-06-01, 2020-08-30)</span></span></code></pre></div>
<p>If you aren’t looking for the <code>%in%</code>-like behavior of
<code>iv_between()</code>, and instead want to pairwise detect whether
one value falls between an interval or not, you can use
<code>iv_pairwise_between()</code>:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">12</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1]  1  5 10 12</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">iv_pairs</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>), <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">9</span>), <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">12</span>), <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">12</span>))</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>y</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;double&gt;[4]&gt;</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [0, 6)   [7, 9)   [10, 12) [10, 12)</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_pairwise_between</span>(x, y)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1]  TRUE FALSE  TRUE FALSE</span></span></code></pre></div>
<p>Keep in mind that the intervals are half-open, so <code>12</code>
doesn’t fall between the interval of <code>[10, 12)</code>! This is
different from <code>dplyr::between()</code>.</p>
</div>
</div>
<div id="counting-overlaps" class="section level2">
<h2>Counting overlaps</h2>
<p>Sometimes you just need the counts of the number of overlaps rather
than the actual locations of them. For example, say your business has a
subscription service and you’d like to compute a rolling monthly count
of the total number of subscriptions that are active (i.e. in January
2019, how many subscriptions were active?). Customers are only allowed
to have one subscription active at once, but they may cancel it and
reactivate it at any time. If a customer was active at any point during
the month, then they are counted in that month.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>enrollments <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>name,      <span class="sc">~</span>start,          <span class="sc">~</span>end,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Amy&quot;</span>,      <span class="st">&quot;1, Jan, 2017&quot;</span>,  <span class="st">&quot;30, Jul, 2018&quot;</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Franklin&quot;</span>, <span class="st">&quot;1, Jan, 2017&quot;</span>,  <span class="st">&quot;19, Feb, 2017&quot;</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Franklin&quot;</span>, <span class="st">&quot;5, Jun, 2017&quot;</span>,  <span class="st">&quot;4, Feb, 2018&quot;</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Franklin&quot;</span>, <span class="st">&quot;21, Oct, 2018&quot;</span>, <span class="st">&quot;9, Mar, 2019&quot;</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Samir&quot;</span>,    <span class="st">&quot;1, Jan, 2017&quot;</span>,  <span class="st">&quot;4, Feb, 2017&quot;</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Samir&quot;</span>,    <span class="st">&quot;5, Apr, 2017&quot;</span>,  <span class="st">&quot;12, Jun, 2018&quot;</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse these into &quot;day&quot; precision year-month-day objects</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>enrollments <span class="ot">&lt;-</span> enrollments <span class="sc">%&gt;%</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">year_month_day_parse</span>(start, <span class="at">format =</span> <span class="st">&quot;%d, %b, %Y&quot;</span>),</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">end =</span> <span class="fu">year_month_day_parse</span>(end, <span class="at">format =</span> <span class="st">&quot;%d, %b, %Y&quot;</span>),</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>enrollments</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   name     start      end       </span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;ymd&lt;day&gt;&gt; &lt;ymd&lt;day&gt;&gt;</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Amy      2017-01-01 2018-07-30</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Franklin 2017-01-01 2017-02-19</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Franklin 2017-06-05 2018-02-04</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Franklin 2018-10-21 2019-03-09</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Samir    2017-01-01 2017-02-04</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 Samir    2017-04-05 2018-06-12</span></span></code></pre></div>
<p>Even though we have day precision information, we only actually need
month precision intervals to answer this question. We’ll use
<code>calendar_narrow()</code> from clock to convert our
<code>&quot;day&quot;</code> precision dates to <code>&quot;month&quot;</code> precision
ones. We’ll also add 1 month to the <code>end</code> intervals to
reflect the fact that the end month is open (remember, ivs are
half-open).</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>enrollments <span class="ot">&lt;-</span> enrollments <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">calendar_narrow</span>(start, <span class="st">&quot;month&quot;</span>),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">end =</span> <span class="fu">calendar_narrow</span>(end, <span class="st">&quot;month&quot;</span>) <span class="sc">+</span> 1L</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>enrollments</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   name     start        end         </span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;ymd&lt;month&gt;&gt; &lt;ymd&lt;month&gt;&gt;</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Amy      2017-01      2018-08     </span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Franklin 2017-01      2017-03     </span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Franklin 2017-06      2018-03     </span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Franklin 2018-10      2019-04     </span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Samir    2017-01      2017-03     </span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 Samir    2017-04      2018-07</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>enrollments <span class="ot">&lt;-</span> enrollments <span class="sc">%&gt;%</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">active =</span> <span class="fu">iv</span>(start, end), <span class="at">.keep =</span> <span class="st">&quot;unused&quot;</span>)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>enrollments</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 2</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   name                 active</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;      &lt;iv&lt;ymd&lt;month&gt;&gt;&gt;</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Amy      [2017-01, 2018-08)</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Franklin [2017-01, 2017-03)</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Franklin [2017-06, 2018-03)</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Franklin [2018-10, 2019-04)</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Samir    [2017-01, 2017-03)</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 Samir    [2017-04, 2018-07)</span></span></code></pre></div>
<p>To answer this question, we are going to need to create a sequential
vector of months that span the entire range of intervals. This starts at
the smallest <code>start</code> and goes to the largest
<code>end</code>. Because the <code>end</code> is half-open, there won’t
be any hits for that month, so we won’t include it.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>bounds <span class="ot">&lt;-</span> <span class="fu">range</span>(enrollments<span class="sc">$</span>active)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>lower <span class="ot">&lt;-</span> <span class="fu">iv_start</span>(bounds[[<span class="dv">1</span>]])</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>upper <span class="ot">&lt;-</span> <span class="fu">iv_end</span>(bounds[[<span class="dv">2</span>]]) <span class="sc">-</span> 1L</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>months <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">month =</span> <span class="fu">seq</span>(lower, upper, <span class="at">by =</span> <span class="dv">1</span>))</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>months</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 27 × 1</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    month       </span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;ymd&lt;month&gt;&gt;</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 2017-01     </span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 2017-02     </span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 2017-03     </span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 2017-04     </span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 2017-05     </span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 2017-06     </span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 2017-07     </span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 2017-08     </span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 2017-09     </span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 2017-10     </span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 17 more rows</span></span></code></pre></div>
<p>Now we need to add a column to <code>months</code> to represent the
number of subscriptions that were active in that month. To do this we
can use <code>iv_count_between()</code>. It works like
<code>iv_between()</code> and <code>iv_locate_between()</code> but
returns an integer vector corresponding to the number of times the
<code>i</code>-th “needle” value fell between any of the values in the
“haystack”.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>months <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">count =</span> <span class="fu">iv_count_between</span>(month, enrollments<span class="sc">$</span>active)) <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 27 × 2</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    month        count</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;ymd&lt;month&gt;&gt; &lt;int&gt;</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 2017-01          3</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 2017-02          3</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 2017-03          1</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 2017-04          2</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 2017-05          2</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 2017-06          3</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 2017-07          3</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 2017-08          3</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 2017-09          3</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 2017-10          3</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11 2017-11          3</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12 2017-12          3</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 13 2018-01          3</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 14 2018-02          3</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 15 2018-03          2</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 16 2018-04          2</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 17 2018-05          2</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 18 2018-06          2</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 19 2018-07          1</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 20 2018-08          0</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 21 2018-09          0</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 22 2018-10          1</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 23 2018-11          1</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 24 2018-12          1</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 25 2019-01          1</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 26 2019-02          1</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 27 2019-03          1</span></span></code></pre></div>
<p>There are also <code>iv_count_overlaps()</code>,
<code>iv_count_precedes()</code>, and <code>iv_count_follows()</code>
for working with two ivs at once.</p>
</div>
<div id="grouping-by-overlaps" class="section level2">
<h2>Grouping by overlaps</h2>
<p>One common operation when working with interval vectors is merging
all the overlapping intervals within a single interval vector. This
removes all the redundant information, while still maintaining the full
range covered by the iv. For this, you can use <code>iv_groups()</code>
which computes the minimal set of interval “groups” that contain all of
the intervals in <code>x</code>.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">iv_pairs</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">7</span>), <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">11</span>), <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">13</span>), <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">13</span>))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;double&gt;[5]&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [1, 5)   [5, 7)   [9, 11)  [10, 13) [12, 13)</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_groups</span>(x)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;double&gt;[2]&gt;</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [1, 7)  [9, 13)</span></span></code></pre></div>
<p>By default, this grouped <em>abutting</em> intervals that aren’t
considered to overlap but also don’t have any values between them. If
you don’t want this, use the <code>abutting</code> argument.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_groups</span>(x, <span class="at">abutting =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;double&gt;[3]&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [1, 5)  [5, 7)  [9, 13)</span></span></code></pre></div>
<div id="with-.by" class="section level3">
<h3>With <code>.by</code></h3>
<p>Grouping overlapping intervals is often a useful way to create a new
variable to group on with dplyr’s <code>.by</code> argument. For
example, consider the following problem where you have multiple users
racking up costs across multiple systems. The date ranges represent the
range when the corresponding cost was accrued over, and the ranges don’t
overlap for a given <code>(user, system)</code> pair.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>costs <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>user, <span class="sc">~</span>system, <span class="sc">~</span>from, <span class="sc">~</span>to, <span class="sc">~</span>cost,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  1L, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;2019-01-01&quot;</span>, <span class="st">&quot;2019-01-05&quot;</span>, <span class="fl">200.5</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  1L, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;2019-01-12&quot;</span>, <span class="st">&quot;2019-01-13&quot;</span>, <span class="fl">15.6</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  1L, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;2019-01-03&quot;</span>, <span class="st">&quot;2019-01-10&quot;</span>, <span class="fl">500.3</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  2L, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;2019-01-02&quot;</span>, <span class="st">&quot;2019-01-03&quot;</span>, <span class="fl">25.6</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  2L, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;2019-01-03&quot;</span>, <span class="st">&quot;2019-01-04&quot;</span>, <span class="dv">30</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  2L, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;2019-01-05&quot;</span>, <span class="st">&quot;2019-01-07&quot;</span>, <span class="fl">66.2</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>costs <span class="ot">&lt;-</span> costs <span class="sc">%&gt;%</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">from =</span> <span class="fu">as.Date</span>(from),</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">to =</span> <span class="fu">as.Date</span>(to)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">range =</span> <span class="fu">iv</span>(from, to), <span class="at">.keep =</span> <span class="st">&quot;unused&quot;</span>)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>costs</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    user system  cost                    range</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt;               &lt;iv&lt;date&gt;&gt;</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 a      200.  [2019-01-01, 2019-01-05)</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     1 a       15.6 [2019-01-12, 2019-01-13)</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     1 b      500.  [2019-01-03, 2019-01-10)</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     2 a       25.6 [2019-01-02, 2019-01-03)</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     2 c       30   [2019-01-03, 2019-01-04)</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6     2 c       66.2 [2019-01-05, 2019-01-07)</span></span></code></pre></div>
<p>Now let’s say you don’t care about the <code>system</code> anymore,
and instead want to sum up the costs for any overlapping date ranges for
a particular <code>user</code>. <code>iv_groups()</code> can give us an
idea of what the non-overlapping ranges would be for each user:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>costs <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">range =</span> <span class="fu">iv_groups</span>(range), <span class="at">.by =</span> user)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 4 × 2</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    user                    range</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;               &lt;iv&lt;date&gt;&gt;</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 [2019-01-01, 2019-01-10)</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     1 [2019-01-12, 2019-01-13)</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     2 [2019-01-02, 2019-01-04)</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     2 [2019-01-05, 2019-01-07)</span></span></code></pre></div>
<p>But how can we sum up the costs? For this, we need to turn to
<code>iv_identify_group()</code> which allows us to identify the group
that each <code>range</code> falls in. This will give us something to
group on so we can sum up the costs.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>costs2 <span class="ot">&lt;-</span> costs <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">range =</span> <span class="fu">iv_identify_group</span>(range), <span class="at">.by =</span> user)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># `range` has been updated with the corresponding group</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>costs2</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    user system  cost                    range</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt;               &lt;iv&lt;date&gt;&gt;</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 a      200.  [2019-01-01, 2019-01-10)</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     1 a       15.6 [2019-01-12, 2019-01-13)</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     1 b      500.  [2019-01-01, 2019-01-10)</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     2 a       25.6 [2019-01-02, 2019-01-04)</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     2 c       30   [2019-01-02, 2019-01-04)</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6     2 c       66.2 [2019-01-05, 2019-01-07)</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co"># So now we can group on that to summarise the cost</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>costs2 <span class="sc">%&gt;%</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cost =</span> <span class="fu">sum</span>(cost), <span class="at">.by =</span> <span class="fu">c</span>(user, range))</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 4 × 3</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    user                    range  cost</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;               &lt;iv&lt;date&gt;&gt; &lt;dbl&gt;</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 [2019-01-01, 2019-01-10) 701. </span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     1 [2019-01-12, 2019-01-13)  15.6</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     2 [2019-01-02, 2019-01-04)  55.6</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     2 [2019-01-05, 2019-01-07)  66.2</span></span></code></pre></div>
</div>
<div id="minimal-ivs" class="section level3">
<h3>Minimal ivs</h3>
<p><code>iv_groups()</code> is a critical function in this package
because its defaults also produce what is known as a <em>minimal</em>
iv. A minimal interval vector:</p>
<ul>
<li><p>Has no overlapping intervals</p></li>
<li><p>Has no abutting intervals</p></li>
<li><p>Is ordered on both <code>iv_start(x)</code> and
<code>iv_end(x)</code></p></li>
</ul>
<p>Minimal interval vectors are nice because they cover the range of an
interval vector in the most compact form possible. They are also nice to
know about because the set operations described in the set operations
section below all return minimal interval vectors.</p>
</div>
</div>
<div id="splitting-on-endpoints" class="section level2">
<h2>Splitting on endpoints</h2>
<p>While <code>iv_groups()</code> generates <em>less</em> intervals than
you began with, it is sometimes useful to go the other way and generate
<em>more</em> intervals by splitting on all the overlapping endpoints.
This is what <code>iv_splits()</code> does. Both operations end up
generating a result that contains completely disjoint intervals, but
they go about it in very different ways.</p>
<p>Let’s look back at our first <code>iv_groups()</code> example:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">iv_pairs</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">7</span>), <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">11</span>), <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">13</span>), <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">13</span>))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;double&gt;[5]&gt;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [1, 5)   [5, 7)   [9, 11)  [10, 13) [12, 13)</span></span></code></pre></div>
<p>Notice that <code>[9, 11)</code> overlaps <code>[10, 13)</code> which
in turn overlaps <code>[12, 13)</code>. If we looked at the sorted
unique values of the endpoints (i.e. <code>c(9, 10, 11, 12, 13)</code>)
and then paired these up like
<code>[9, 10), [10, 11), [11, 12], [12, 13)</code>, then we will have
nicely split on the endpoints, generating a disjoint set of intervals
that we refer to as “splits”. <code>iv_splits()</code> returns these
intervals.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_splits</span>(x)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;double&gt;[6]&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [1, 5)   [5, 7)   [9, 10)  [10, 11) [11, 12) [12, 13)</span></span></code></pre></div>
<div id="with-.by-1" class="section level3">
<h3>With <code>.by</code></h3>
<p>Splitting an iv into its disjoint pieces is another operation that
works nicely with <code>.by</code>. Consider this data set containing
details about a number of guests that arrived to your party. You’ve been
meticulous, so you’ve got their arrival and departure times logged
(don’t ask me why, maybe it’s for COVID-19 Contact Tracing
purposes).</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>guests <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">arrive =</span> <span class="fu">as.POSIXct</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;2008-05-20 19:30:00&quot;</span>, <span class="st">&quot;2008-05-20 20:10:00&quot;</span>, <span class="st">&quot;2008-05-20 22:15:00&quot;</span>),</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">tz =</span> <span class="st">&quot;UTC&quot;</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">depart =</span> <span class="fu">as.POSIXct</span>(</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;2008-05-20 23:00:00&quot;</span>, <span class="st">&quot;2008-05-21 00:00:00&quot;</span>, <span class="st">&quot;2008-05-21 00:30:00&quot;</span>),</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">tz =</span> <span class="st">&quot;UTC&quot;</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">list</span>(</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;Mary&quot;</span>, <span class="st">&quot;Harry&quot;</span>),</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;Diana&quot;</span>, <span class="st">&quot;Susan&quot;</span>),</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Peter&quot;</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>guests <span class="ot">&lt;-</span> <span class="fu">unnest</span>(guests, name) <span class="sc">%&gt;%</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iv =</span> <span class="fu">iv</span>(arrive, depart), <span class="at">.keep =</span> <span class="st">&quot;unused&quot;</span>)</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>guests</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 2</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   name                                          iv</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                                 &lt;iv&lt;dttm&gt;&gt;</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Mary  [2008-05-20 19:30:00, 2008-05-20 23:00:00)</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Harry [2008-05-20 19:30:00, 2008-05-20 23:00:00)</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Diana [2008-05-20 20:10:00, 2008-05-21 00:00:00)</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Susan [2008-05-20 20:10:00, 2008-05-21 00:00:00)</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Peter [2008-05-20 22:15:00, 2008-05-21 00:30:00)</span></span></code></pre></div>
<p>Let’s figure out who was at your party at any given point throughout
the night. To do this, we’ll need to break <code>iv</code> up into all
possible disjoint intervals that mark either an arrival or departure.
Like with <code>iv_groups()</code>, <code>iv_splits()</code> can show us
those disjoint intervals, but this doesn’t help us map them back to each
guest.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_splits</span>(guests<span class="sc">$</span>iv)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;datetime&lt;UTC&gt;&gt;[5]&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [2008-05-20 19:30:00, 2008-05-20 20:10:00)</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2] [2008-05-20 20:10:00, 2008-05-20 22:15:00)</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3] [2008-05-20 22:15:00, 2008-05-20 23:00:00)</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4] [2008-05-20 23:00:00, 2008-05-21 00:00:00)</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5] [2008-05-21 00:00:00, 2008-05-21 00:30:00)</span></span></code></pre></div>
<p>Instead, we’ll need <code>iv_identify_splits()</code>, which
identifies which of the splits overlap with each of the original
intervals and returns a list of the results which works nicely as a
list-column. This is a little easier to understand if we first look at a
single guest:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mary&#39;s arrival/departure times</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>guests<span class="sc">$</span>iv[[<span class="dv">1</span>]]</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;datetime&lt;UTC&gt;&gt;[1]&gt;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [2008-05-20 19:30:00, 2008-05-20 23:00:00)</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The first start and last end correspond to Mary&#39;s original times,</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># but we&#39;ve also broken her stay up by the departures/arrivals of</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co"># everyone else</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_identify_splits</span>(guests<span class="sc">$</span>iv)[[<span class="dv">1</span>]]</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;datetime&lt;UTC&gt;&gt;[3]&gt;</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [2008-05-20 19:30:00, 2008-05-20 20:10:00)</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2] [2008-05-20 20:10:00, 2008-05-20 22:15:00)</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3] [2008-05-20 22:15:00, 2008-05-20 23:00:00)</span></span></code></pre></div>
<p>Since this generates a list-column, we’ll also immediately use
<code>tidyr::unnest()</code> to expand it out.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>guests2 <span class="ot">&lt;-</span> guests <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iv =</span> <span class="fu">iv_identify_splits</span>(iv)) <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(iv) <span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(iv)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>guests2</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 15 × 2</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    name                                          iv</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;                                 &lt;iv&lt;dttm&gt;&gt;</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Mary  [2008-05-20 19:30:00, 2008-05-20 20:10:00)</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 Harry [2008-05-20 19:30:00, 2008-05-20 20:10:00)</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Mary  [2008-05-20 20:10:00, 2008-05-20 22:15:00)</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 Harry [2008-05-20 20:10:00, 2008-05-20 22:15:00)</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Diana [2008-05-20 20:10:00, 2008-05-20 22:15:00)</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Susan [2008-05-20 20:10:00, 2008-05-20 22:15:00)</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Mary  [2008-05-20 22:15:00, 2008-05-20 23:00:00)</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Harry [2008-05-20 22:15:00, 2008-05-20 23:00:00)</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Diana [2008-05-20 22:15:00, 2008-05-20 23:00:00)</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Susan [2008-05-20 22:15:00, 2008-05-20 23:00:00)</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11 Peter [2008-05-20 22:15:00, 2008-05-20 23:00:00)</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12 Diana [2008-05-20 23:00:00, 2008-05-21 00:00:00)</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 13 Susan [2008-05-20 23:00:00, 2008-05-21 00:00:00)</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 14 Peter [2008-05-20 23:00:00, 2008-05-21 00:00:00)</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 15 Peter [2008-05-21 00:00:00, 2008-05-21 00:30:00)</span></span></code></pre></div>
<p>Now that we have the splits for each guest, we can group by
<code>iv</code> and summarize to figure out who was at the party at any
point throughout the night.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>guests2 <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">who =</span> <span class="fu">list</span>(name), <span class="at">.by =</span> iv)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 3</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                           iv     n who      </span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                   &lt;iv&lt;dttm&gt;&gt; &lt;int&gt; &lt;list&gt;   </span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 [2008-05-20 19:30:00, 2008-05-20 20:10:00)     2 &lt;chr [2]&gt;</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 [2008-05-20 20:10:00, 2008-05-20 22:15:00)     4 &lt;chr [4]&gt;</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 [2008-05-20 22:15:00, 2008-05-20 23:00:00)     5 &lt;chr [5]&gt;</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 [2008-05-20 23:00:00, 2008-05-21 00:00:00)     3 &lt;chr [3]&gt;</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 [2008-05-21 00:00:00, 2008-05-21 00:30:00)     1 &lt;chr [1]&gt;</span></span></code></pre></div>
</div>
</div>
<div id="set-operations" class="section level2">
<h2>Set operations</h2>
<p>There are a number of set theoretical operations that you can use on
ivs. These are:</p>
<ul>
<li><p><code>iv_set_complement()</code></p></li>
<li><p><code>iv_set_union()</code></p></li>
<li><p><code>iv_set_intersect()</code></p></li>
<li><p><code>iv_set_difference()</code></p></li>
<li><p><code>iv_set_symmetric_difference()</code></p></li>
</ul>
<p><code>iv_set_complement()</code> works on a single iv, while all the
others work on two intervals at a time. All of these functions return a
<em>minimal</em> interval vector. The easiest way to think about these
functions is to imagine <code>iv_groups()</code> being called on each of
the inputs first (to reduce them down to their minimal form) before
applying the operation.</p>
<p><code>iv_set_complement()</code> computes the set complement of the
intervals in a single iv.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">iv_pairs</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">12</span>), <span class="fu">c</span>(<span class="dv">13</span>, <span class="dv">15</span>))</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;double&gt;[4]&gt;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [1, 3)   [2, 5)   [10, 12) [13, 15)</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_set_complement</span>(x)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;double&gt;[2]&gt;</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [5, 10)  [12, 13)</span></span></code></pre></div>
<p>By default, <code>iv_set_complement()</code> uses the
smallest/largest values of its input as the bounds to compute the
complement over, but you can supply bounds explicitly with
<code>lower</code> and <code>upper</code>:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_set_complement</span>(x, <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">upper =</span> <span class="cn">Inf</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;double&gt;[4]&gt;</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [0, 1)    [5, 10)   [12, 13)  [15, Inf)</span></span></code></pre></div>
<p><code>iv_set_union()</code> takes the union of two ivs. It is
essentially a call to <code>vctrs::vec_c()</code> followed by
<code>iv_groups()</code>. It answers the question, “Which intervals are
in <code>x</code> or <code>y</code>?”</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">iv_pairs</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">10</span>), <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">16</span>))</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;double&gt;[4]&gt;</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [1, 3)   [2, 5)   [10, 12) [13, 15)</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>y</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;double&gt;[4]&gt;</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [-5, 0)  [1, 4)   [8, 10)  [15, 16)</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_set_union</span>(x, y)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;double&gt;[4]&gt;</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [-5, 0)  [1, 5)   [8, 12)  [13, 16)</span></span></code></pre></div>
<p><code>iv_set_intersect()</code> takes the intersection of two ivs. It
answers the question, “Which intervals are in <code>x</code> and
<code>y</code>?”</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_set_intersect</span>(x, y)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;double&gt;[1]&gt;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [1, 4)</span></span></code></pre></div>
<p><code>iv_set_difference()</code> takes the asymmetrical difference of
two ivs. It answers the question, “Which intervals are in <code>x</code>
but not <code>y</code>?”</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_set_difference</span>(x, y)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;double&gt;[3]&gt;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [4, 5)   [10, 12) [13, 15)</span></span></code></pre></div>
</div>
<div id="pairwise-set-operations" class="section level2">
<h2>Pairwise set operations</h2>
<p>The set operations described above all treat <code>x</code> and
<code>y</code> as two complete “sets” of intervals and operate on the
intervals as a group. Occasionally it is useful to have pairwise
equivalents of these operations that, say, take the intersection of the
i-th interval of <code>x</code> and the i-th interval of
<code>y</code>.</p>
<p>One case in particular comes from combining
<code>iv_locate_overlaps()</code> with
<code>iv_pairwise_set_intersect()</code>. Here you might want to know
not only <em>where</em> two ivs overlaps, but also <em>what</em> that
intersection was for each value in <code>x</code>.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>starts <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">&quot;2019-01-05&quot;</span>, <span class="st">&quot;2019-01-20&quot;</span>, <span class="st">&quot;2019-01-25&quot;</span>, <span class="st">&quot;2019-02-01&quot;</span>))</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>ends <span class="ot">&lt;-</span> starts <span class="sc">+</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">3</span>, <span class="dv">5</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">iv</span>(starts, ends)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>starts <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">&quot;2019-01-02&quot;</span>, <span class="st">&quot;2019-01-23&quot;</span>))</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>ends <span class="ot">&lt;-</span> starts <span class="sc">+</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">iv</span>(starts, ends)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;date&gt;[4]&gt;</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [2019-01-05, 2019-01-10) [2019-01-20, 2019-01-30) [2019-01-25, 2019-01-28)</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4] [2019-02-01, 2019-02-06)</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>y</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;date&gt;[2]&gt;</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [2019-01-02, 2019-01-07) [2019-01-23, 2019-01-29)</span></span></code></pre></div>
<p><code>iv_set_intersect()</code> isn’t very useful to answer this
particular question, because it first merges all overlapping intervals
in each input.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_set_intersect</span>(x, y)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;date&gt;[2]&gt;</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [2019-01-05, 2019-01-07) [2019-01-23, 2019-01-29)</span></span></code></pre></div>
<p>Instead, we can find the overlaps and align them, and then pairwise
intersect the results:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>locations <span class="ot">&lt;-</span> <span class="fu">iv_locate_overlaps</span>(x, y, <span class="at">no_match =</span> <span class="st">&quot;drop&quot;</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>overlaps <span class="ot">&lt;-</span> <span class="fu">iv_align</span>(x, y, <span class="at">locations =</span> locations)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>overlaps <span class="sc">%&gt;%</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">intersect =</span> <span class="fu">iv_pairwise_set_intersect</span>(needles, haystack))</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                    needles                 haystack                intersect</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 [2019-01-05, 2019-01-10) [2019-01-02, 2019-01-07) [2019-01-05, 2019-01-07)</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 [2019-01-20, 2019-01-30) [2019-01-23, 2019-01-29) [2019-01-23, 2019-01-29)</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 [2019-01-25, 2019-01-28) [2019-01-23, 2019-01-29) [2019-01-25, 2019-01-28)</span></span></code></pre></div>
<p>Note that the pairwise set operations come with a number of
restrictions that limit their usage in many cases. For example,
<code>iv_pairwise_set_intersect()</code> requires that <code>x[i]</code>
and <code>y[i]</code> overlap, otherwise they would result in an empty
interval, which isn’t allowed.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_pairwise_set_intersect</span>(<span class="fu">iv</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="fu">iv</span>(<span class="dv">6</span>, <span class="dv">9</span>))</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in `iv_pairwise_set_intersect()`:</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ! Can&#39;t take the intersection of non-overlapping intervals.</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ This would result in an empty interval.</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Location 1 contains non-overlapping intervals.</span></span></code></pre></div>
<p>See the documentation page of
<code>iv_pairwise_set_intersect()</code> for a complete list of
restrictions for all of the pairwise set operations.</p>
</div>
<div id="missing-intervals" class="section level2">
<h2>Missing intervals</h2>
<p>Missing intervals are allowed in ivs, you can generate them by
supplying vectors to <code>iv()</code> or <code>iv_pairs()</code> that
contain missing values in either input.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">iv_pairs</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">3</span>, <span class="cn">NA</span>), <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">3</span>))</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;double&gt;[3]&gt;</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [1, 5)   [NA, NA) [NA, NA)</span></span></code></pre></div>
<p>The defaults of all functions in ivs treat missing intervals in one
of two ways:</p>
<ul>
<li><p>Match-like operations treat missing intervals as
<em>overlapping</em> other missing intervals, but they won’t overlap any
other interval. These include <code>iv_locate_overlaps()</code>,
<code>iv_set_intersect()</code>, and <code>iv_splits()</code>.</p></li>
<li><p>Pairwise operations treat missing intervals as
<em>infectious</em>, meaning that if the i-th interval of <code>x</code>
is missing and the i-th interval of <code>y</code> is not missing (or
vice versa), then the result is forced to be a missing interval. These
include any operations prefixed with
<code>iv_pairwise_*()</code>.</p></li>
</ul>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">iv_pairs</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>))</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>y</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;double&gt;[2]&gt;</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [NA, NA) [0, 2)</span></span></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Match-like operations treat missing intervals as overlapping</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_locate_overlaps</span>(x, y)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   needles haystack</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1       1        2</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2       2        1</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3       3        1</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_set_intersect</span>(x, y)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;double&gt;[2]&gt;</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [1, 2)   [NA, NA)</span></span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pairwise operations treat missing intervals as infectious</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">iv_pairs</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>))</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_pairwise_set_intersect</span>(y, z)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;iv&lt;double&gt;[2]&gt;</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] [NA, NA) [1, 2)</span></span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
